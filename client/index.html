<!doctype html>
<meta charset="utf-8">
<title>Lakdi Connection Test</title>
<h1>Lakdi â€“ Connection Test</h1>
<p id="status">Connectingâ€¦</p>
<button id="pingBtn" disabled>Ping server</button>
<pre id="log" style="background:#111;color:#0f0;padding:12px;border-radius:8px;min-height:120px;"></pre>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script>
  const SOCKET_URL = "https://lakdi.onrender.com"; // NOTE: https, not wss â€“ Socket.IO handles upgrade
  const socket = io(SOCKET_URL, { transports: ["polling", "websocket"], upgrade: true });

  const status = document.getElementById("status");
  const log = (...args) => {
    const el = document.getElementById("log");
    el.textContent += args.map(a => (typeof a === "string" ? a : JSON.stringify(a))).join(" ") + "\n";
  };

  socket.on("connect", () => {
    status.textContent = "âœ… Connected: " + socket.id;
    document.getElementById("pingBtn").disabled = false;
    log("connected", socket.id);
  });
  socket.on("connect_error", (err) => { status.textContent = "âŒ connect_error"; log("connect_error:", err.message || err); });
  socket.on("disconnect", (r) => { status.textContent = "ðŸ”Œ disconnected"; log("disconnect:", r); });

  document.getElementById("pingBtn").onclick = () => {
    socket.emit("ping", null, (reply) => log("pong?", reply));
  };

  // Safety: show unhandled promise errors clearly
  window.addEventListener("unhandledrejection", e => log("unhandledrejection:", (e.reason && e.reason.message) || e.reason));
</script>
