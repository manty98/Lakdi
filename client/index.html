// server.js — single-file static server for your all-in-one index.html
const path = require("path");
const express = require("express");
const compression = require("compression");
const helmet = require("helmet");

const app = express();

// Basic hardening + gzip
app.use(helmet({
  contentSecurityPolicy: false, // your inline <script> needs this off
}));
app.use(compression());

// Serve the folder this file is in (index.html + assets if any)
app.use(express.static(__dirname, {
  extensions: ["html"], // so "/" loads index.html
  maxAge: "1h",
  setHeaders(res, filePath) {
    if (filePath.endsWith("index.html")) {
      // don’t cache the HTML shell
      res.setHeader("Cache-Control", "no-store");
    }
  }
}));

// Health check for Render
app.get("/health", (_req, res) => res.status(200).send("ok"));

// Fallback to index.html (optional; helpful if you later add client-side routing)
app.use((_req, res) => res.sendFile(path.join(__dirname, "index.html")));

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Lakdi static server listening on :${PORT}`);
});
